services:
  api:
    build:
      context: .
      dockerfile: Dockerfile
      target: development
    container_name: kevbot_api
    environment:
      DB_CONNECTION_STRING: ${DB_CONNECTION_STRING}
      GCP_API_ENDPOINT: ${GCP_API_ENDPOINT}
      GCP_TRACKS_BUCKET_NAME: ${GCP_TRACKS_BUCKET_NAME}
      KEVBOT_API_ADDRESS: ${KEVBOT_API_ADDRESS}
      KEVBOT_API_JWT_SECRET: ${KEVBOT_API_JWT_SECRET}
      KEVBOT_API_PORT: ${KEVBOT_API_PORT}
      BOT_AUTH_API_KEY: ${BOT_AUTH_API_KEY}
      DEV_ROUTES_ALLOWED: ${DEV_ROUTES_ALLOWED}
      DEV_AUTH_SECRET: ${DEV_AUTH_SECRET}
      AUTH_ACCESS_TOKEN_TTL_MINUTES: ${AUTH_ACCESS_TOKEN_TTL_MINUTES}
      AUTH_REFRESH_SESSION_TTL_DAYS: ${AUTH_REFRESH_SESSION_TTL_DAYS}
      AUTH_REFRESH_COOKIE_NAME: ${AUTH_REFRESH_COOKIE_NAME}
      AUTH_REFRESH_COOKIE_PATH: ${AUTH_REFRESH_COOKIE_PATH}
      AUTH_JWT_AUDIENCE: ${AUTH_JWT_AUDIENCE}
      AUTH_JWT_ISSUER: ${AUTH_JWT_ISSUER}
      NODE_ENV: ${NODE_ENV}
      DISCORD_OAUTH2_CLIENT_ID: ${DISCORD_OAUTH2_CLIENT_ID}
      DISCORD_OAUTH2_CLIENT_SECRET: ${DISCORD_OAUTH2_CLIENT_SECRET}
      DISCORD_OAUTH2_REDIRECT_URI: ${DISCORD_OAUTH2_REDIRECT_URI}
    volumes:
      - .:/api
      - /api/node_modules/ # use containers node_modules
    ports:
      - ${KEVBOT_API_PORT}:${KEVBOT_API_PORT}
