---
name: Release Process & Versioning Strategy
overview: ""
todos:
  - id: 58759e75-d3ff-4aad-93f8-d3b1d264b16f
    content: Configure GitHub branch protection and squash-merge-only settings
    status: pending
  - id: ba3ff474-3a1d-41c8-90bf-ce0b9f41e245
    content: Create release-please workflow and configuration files for monorepo
    status: pending
  - id: 07c33e70-2e2b-4f64-9637-520afb92f2b2
    content: Add VERSION.txt files for tools and gcloud components
    status: pending
  - id: e243c198-5895-4a0d-9407-4a2a2bddd149
    content: Rewrite CONTRIBUTING.md with complete workflow, commit examples, and release process
    status: pending
  - id: 2f110e80-1991-40e1-815d-7d251787602b
    content: Bootstrap component CHANGELOGs with current versions if needed
    status: pending
  - id: 5eae3e47-81ef-44af-a947-4a10ff2e4eab
    content: Update deployment workflows to support tag-based releases
    status: pending
  - id: 61bf20e7-fe88-4220-bd53-218f06bde80c
    content: Clean up RELEASE_NOTES.md and CONTRIBUTING_OLD.md, update README.md
    status: pending
  - id: 6a7d34b2-85d6-4384-afe6-cddd8abffe1f
    content: Add commit message template and VS Code recommendations (optional)
    status: pending
---

# Release Process & Versioning Strategy

## Overview

Implement a semi-automated release process that handles independent component versioning (api, db, frontend, bot, tools, gcloud) with coordinated project-level releases, leveraging squash merges and PR title enforcement only.

## Key Decisions

- **Automation**: Semi-automated with release-please (generates changelogs, you approve releases)
- **Versioning**: Independent component versions (`api@2.1.0`) + coordinated project releases (`v3.0.0`)
- **PR Strategy**: Squash merge only (cleans up WIP commits, PR title = final commit)
- **Commit Enforcement**: Only PR titles and direct pushes to main (NOT branch commits)
- **Documentation**: Auto-generated component CHANGELOGs + manual user-facing RELEASE_NOTES.md

## Implementation Steps

### 1. GitHub Repository Settings

Configure branch protection and merge settings:

- Enable "Allow squash merging" only on main branch
- Disable "Allow merge commits" and "Allow rebase merging"
- Set default commit message to "Pull request title"
- Require PR reviews (optional but recommended)
- Require status checks (lint-pr-title, CI)

### 2. Fix Commit Linting Strategy

**The Problem**: With squash merge, individual commits in PRs get discarded - only the PR title becomes the final commit!**What needs conventional format**:

- ✅ PR titles (already enforced via `lint-pr-title.yml`)
- ✅ Direct pushes to main (prevents bypassing PRs)
- ❌ NOT individual branch commits (they get squashed away anyway)

**Action**: Update `.github/workflows/lint-commit.yml`:

```yaml
on:
  push:
    branches:
    - main
  # Remove pull_request trigger - this was causing pain!
```

This eliminates the painful WIP commit enforcement while keeping main's history clean.

### 3. Release-Please Workflow

Create `.github/workflows/release-please.yml`:

- Configure release-please action for monorepo mode
- Define components: api, db, frontend, bot, tools, gcloud
- Set component paths and versioning
- Auto-create release PRs when commits are merged to main
- Auto-publish GitHub releases when release PRs are merged
- Generate component tags (`api@2.1.0`) automatically

Example config in `.github/release-please-config.json`:

```json
{
  "packages": {
    "api": {
      "component": "api",
      "package-name": "@kevbot/api"
    },
    "db": {
      "component": "db",
      "package-name": "@kevbot/db"
    }
  }
}
```



### 4. Release Notes vs Changelogs

**Two-tier documentation strategy**:**Component CHANGELOGs** (auto-generated by release-please):

- `api/CHANGELOG.md`, `db/CHANGELOG.md`, `frontend/CHANGELOG.md`, etc.
- Technical, detailed, auto-generated from PR titles
- Every component release gets an entry
- Format: Keep a Changelog standard
- Audience: Developers

**RELEASE_NOTES.md** (manual, user-facing):

- Lives at project root
- High-level "what's new" for coordinated releases
- Only updated for major project releases (e.g., `v3.0.0`)
- Human-written highlights and user impact
- Example entry: "v3.0.0 - Added music bot integration, redesigned frontend player"
- Audience: End users and stakeholders

**Workflow**:

1. Component releases happen automatically → CHANGELOGs updated
2. When doing coordinated release, manually update RELEASE_NOTES.md with highlights
3. Tag coordinated release (e.g., `v3.0.0`) alongside component tags

### 5. Component Version Files

Create/update version tracking:

- `api/package.json` - Already exists
- `db/VERSION.txt` - Already exists
- `frontend/package.json` - Already exists
- Add `tools/VERSION.txt`, `gcloud/VERSION.txt` for non-Node components
- Release-please will auto-update these files

### 6. Update Contributing Guide

Replace `CONTRIBUTING.md` with comprehensive workflow:**Development Workflow**:

- Create feature branch: `feat/my-feature` or `fix/my-fix`
- Make commits freely - WIP commits, quick fixes, whatever!
- Commit messages in branches don't matter (they get squashed)
- Open PR with conventional commit title (this is what matters!)
- Example: `feat(api): add track streaming endpoint`

**PR Title Rules** (enforced by CI):

- `feat(scope):` - New features (minor version bump)
- `fix(scope):` - Bug fixes (patch version bump)
- `chore(scope):` - Maintenance, no changelog entry
- `docs(scope):` - Documentation only
- Breaking changes: Add `!` after scope → `feat(api)!: remove legacy endpoint`

**Valid scopes**: project, api, frontend, db, gcloud, tools, bot**Release Process**:

1. Merge PRs to main (always squash merge)
2. Release-please bot updates/creates release PR automatically
3. Review auto-generated CHANGELOGs in the release PR
4. Merge release PR when ready → releases published, tags created
5. For coordinated releases: manually update RELEASE_NOTES.md with user-facing highlights

### 7. Migration Path

Handle existing tags and history:

- Keep existing tags (`api@v2.0.0`, `db@v1.0.0`, old `v1.x.x`)
- Release-please will detect last version from tags
- Bootstrap `.github/.release-please-manifest.json` with current versions
- First release-please run uses existing versions as baseline

### 8. CI/CD Integration

Update deployment workflows:

- `.github/workflows/service-deploy.yml` - Ensure works with component tags
- Consider auto-deploy workflow triggered on release publish
- Tag format: `api@2.1.0` deploys API, `db@1.2.0` deploys DB, etc.

### 9. Documentation Cleanup

- `CONTRIBUTING.md` - Complete rewrite with new workflow
- `README.md` - Add versioning/release section
- Delete `CONTRIBUTING_OLD.md` (obsolete)
- Keep `RELEASE_NOTES.md` - document its new user-facing purpose

### 10. Developer Experience (Optional)

- Add `.gitmessage` commit template (though less important now)
- VS Code extension recommendations for conventional commits
- GitHub PR template that explains title requirements

## Key Files to Create/Modify

- `.github/workflows/lint-commit.yml` (update triggers)
- `.github/workflows/release-please.yml` (new)
- `.github/release-please-config.json` (new)
- `.github/.release-please-manifest.json` (new)
- `CONTRIBUTING.md` (major rewrite)
- `README.md` (add release section)
- `RELEASE_NOTES.md` (update purpose/format)
- `tools/VERSION.txt` (new)
- `gcloud/VERSION.txt` (new)
- Delete `CONTRIBUTING_OLD.md`

## Why This Works

- **No WIP commit pain**: Branch commits don't need conventional format
- **Clean history**: Squash merges create one commit per PR
- **Automated changelogs**: Release-please reads PR titles from git history
- **Flexible versioning**: Components release independently
- **User-facing docs**: RELEASE_NOTES.md for big picture, CHANGELOGs for details